{"version":3,"sources":["Util/chatUtil.js","assets/img/faces/gloria2.jpg","assets/img/faces/jerry.jpg","pages/ChatPage/AdminChatPage.jsx"],"names":["chatFontSize","fontSize","getMessageTimeNotify","utc","localDate","Date","localHr","switchNumber","getHours","localMin","getMinutes","current","now","min","parseInt","hr","toDateString","num","value","toString","length","avatarUser","arg","linda","gloria","carlos","jerry","marc","mediaTitle","user","style","createOn","module","exports","useStyles","makeStyles","sectionCommentsStyle","withRouter","history","classes","useSelector","state","login","useState","undefined","allChatMessageInfo","setAllChatMessageInfo","replyMessage","setReplyMessage","replyImageUrl","setReplyImageUrl","maxMessageNumber","chat","useEffect","chatMsgRef","limitToLast","on","snapshot","messageUpdate","messageInfo","message","push","set","data","val","sliceData","_","slice","values","forEach","item","rawObj","pickBy","key","id","Object","keys","currentSendMsgUser","onMessageDelete","msgId","intervalObject","window","confirm","db","ref","remove","clearInterval","console","log","error","className","section","justify","xs","sm","md","map","index","avatar","title","event","onChange","e","target","onReply","onUpdate","number","reduxDispatch","chatTypes","enableUpdate","enableImageUpload"],"mappings":"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","file":"static/js/18.2f44911d.chunk.js","sourcesContent":["import React from 'react';\r\nimport { carlos, linda } from \"firebaseUtil/user\";\r\nimport marc from \"assets/img/faces/marc.jpg\";\r\nimport gloria from \"assets/img/faces/gloria2.jpg\";\r\nimport jerry from \"assets/img/faces/jerry.jpg\";\r\n\r\nconst chatFontSize = {\r\n    fontSize: '0.7rem'\r\n}\r\n\r\nconst getMessageTimeNotify = (utc) => {\r\n    const localDate = new Date(utc);\r\n    const localHr = switchNumber(localDate.getHours());\r\n    const localMin = switchNumber(localDate.getMinutes());\r\n\r\n    const current = Date.now();\r\n    const diffUtc = parseInt(current - utc, 10);\r\n    const min = (diffUtc / 1000) / 60;\r\n    const hr = min / 60;\r\n    const day = hr / 24;\r\n\r\n    if (min <= 60) {\r\n        // return `${Math.floor(min)} minutes ago`;\r\n        return `${localHr}:${localMin}`;\r\n    } else if (min > 60 && hr <= 24) {\r\n        // return `${Math.floor(hr)} hours ago`;\r\n        // return `${localHr}:${localMin}`;\r\n        return `${localHr}:${localMin} ----- ${localDate.toDateString()}`;\r\n    } else if (hr > 24) {\r\n        // return `${Math.floor(day)} days ago`;\r\n        return `${localHr}:${localMin} ----- ${localDate.toDateString()}`;\r\n    }\r\n\r\n    return min;\r\n}\r\n\r\nconst switchNumber = (num) => {\r\n    const value = num.toString();\r\n    if (value.length === 1) {\r\n        return `0${value}`;\r\n    } else {\r\n        return value;\r\n    }\r\n}\r\n\r\nconst avatarUser = (arg) => {\r\n    if (arg === linda) {\r\n        return gloria;\r\n    } else if (arg === carlos) {\r\n        return jerry;\r\n    } else {\r\n        return marc;\r\n    }\r\n}\r\n\r\nconst mediaTitle = (value) => {\r\n    if (value.user === linda) {\r\n        return (\r\n            <span style={chatFontSize}>\r\n                Karen <small>· {getMessageTimeNotify(value.createOn)} </small>\r\n            </span>\r\n        );\r\n    } else if (value.user === carlos) {\r\n        return (\r\n            <span style={chatFontSize}>\r\n                Kevin <small>· {getMessageTimeNotify(value.createOn)}</small>\r\n            </span>\r\n        );\r\n    } else {\r\n        return (<></>);\r\n    }\r\n}\r\n\r\nexport { mediaTitle, avatarUser }","module.exports = __webpack_public_path__ + \"static/media/gloria2.666943cf.jpg\";","module.exports = __webpack_public_path__ + \"static/media/jerry.2aa27bf0.jpg\";","import _ from 'lodash';\r\nimport React, { useEffect, useState } from \"react\";\r\nimport { useSelector } from \"react-redux\";\r\nimport { withRouter } from \"react-router-dom\";\r\nimport { chatMsgRef } from \"firebaseUtil/firebase\";\r\n// @material-ui/core components\r\nimport { makeStyles } from \"@material-ui/core/styles\";\r\n// core components\r\nimport GridContainer from \"components/Grid/GridContainer.js\";\r\nimport GridItem from \"components/Grid/GridItem.js\";\r\nimport ChatMessage from \"components/Chat/ChatMessage\";\r\nimport ChatInput from \"components/Chat/ChatInput\";\r\nimport { avatarUser, mediaTitle } from 'Util/chatUtil';\r\nimport FloatyAssistant from 'components/Assistant/floaty';\r\nimport sectionCommentsStyle from \"assets/jss/material-kit-pro-react/views/blogPostSections/sectionCommentsStyle.js\";\r\nimport { db } from 'firebaseUtil/firebase';\r\nimport { reduxDispatch } from 'redux/store';\r\nimport * as chatTypes from \"redux/module/chatModule/action\"\r\n\r\nconst useStyles = makeStyles(sectionCommentsStyle);\r\n\r\nconst AdminChatPage = ({ history }) => {\r\n    const classes = useStyles();\r\n    const { user } = useSelector(state => state.login);\r\n    const [allChatMessageInfo, setAllChatMessageInfo] = useState(undefined);\r\n    const [replyMessage, setReplyMessage] = useState(\"\");\r\n    const [replyImageUrl, setReplyImageUrl] = useState(\"\");\r\n    const { maxMessageNumber } = useSelector(state => state.chat);\r\n\r\n    useEffect(() => {\r\n        if (chatMsgRef && maxMessageNumber !== undefined) {\r\n            chatMsgRef.limitToLast(maxMessageNumber).on(\"value\", snapshot => {\r\n                messageUpdate(snapshot);\r\n            });\r\n        }\r\n    }, [maxMessageNumber])\r\n\r\n    useEffect(() => {\r\n        if (user && replyImageUrl && replyImageUrl !== \"\") {\r\n            const messageInfo = {\r\n                user: user,\r\n                message: `${replyImageUrl}`,\r\n                createOn: Date.now()\r\n            }\r\n            chatMsgRef.push().set(messageInfo);\r\n        }\r\n    }, [replyImageUrl])\r\n\r\n    const messageUpdate = (snapshot) => {\r\n        const data = snapshot.val();\r\n        if (data !== null && data !== undefined) {\r\n            // 最多顯示 70 則訊息\r\n            let sliceData = _.slice(_.values(data), -maxMessageNumber);\r\n\r\n            //加入 firebase 參考用 ID\r\n            sliceData.forEach(item => {\r\n                const rawObj = _.pickBy(data, function (value, key) {\r\n                    return value.createOn === item.createOn;\r\n                });\r\n\r\n                if (rawObj) {\r\n                    const id = Object.keys(rawObj)[0];\r\n                    item.id = id;\r\n                }\r\n            });\r\n\r\n            // 最新一則 Po 文的使用者\r\n            const currentSendMsgUser = _.slice(_.values(sliceData), -1)[0].user;\r\n\r\n            // 最新一則 Po 文的訊息 ID (改採用 Po 文時間)\r\n            const currentSendMsgId = _.slice(_.values(sliceData), -1)[0].createOn;\r\n\r\n            // 若最新 Po 文的使用者不是自己(當下登入帳號), 則不要將 Reply Message 清空, 以免尚未回覆的訊息消失\r\n            if (user === currentSendMsgUser) {\r\n                setReplyMessage(\"\");\r\n                setAllChatMessageInfo(sliceData);\r\n            }\r\n            else {\r\n                setAllChatMessageInfo(sliceData);\r\n            }\r\n        }\r\n    }\r\n\r\n    const onMessageDelete = (msgId, intervalObject) => {\r\n        try {\r\n            if (msgId) {\r\n                const isDelete = window.confirm(\"是否刪除?\");\r\n                if (isDelete) {\r\n                    db.ref(`chatMsg/${msgId}`).remove();\r\n                }\r\n\r\n                if (intervalObject) {\r\n                    clearInterval(intervalObject);\r\n                }\r\n            } else {\r\n                console.log(\"msgId not exist\");\r\n            }\r\n        } catch (error) {\r\n            console.log(error);\r\n        }\r\n    }\r\n\r\n    const onReplyClick = event => {\r\n\r\n        if (user && replyMessage !== \"\") {\r\n            const messageInfo = {\r\n                user: user,\r\n                message: replyMessage,\r\n                createOn: Date.now()\r\n            }\r\n            chatMsgRef.push().set(messageInfo);\r\n        }\r\n    }\r\n\r\n    const onUpdateClick = event => {\r\n        if (user) {\r\n            const number = maxMessageNumber + 1;\r\n            reduxDispatch(chatTypes.SET_MAX_MESSAGE_NUMBER, number);\r\n        }\r\n    }\r\n\r\n    return (\r\n        <div className={classes.section}>\r\n            <GridContainer justify=\"center\">\r\n                <GridItem xs={12} sm={8} md={8}>\r\n                    <div>\r\n                        {allChatMessageInfo ? allChatMessageInfo.map((value, index) => {\r\n                            return (\r\n                                <ChatMessage\r\n                                    key={value.id !== undefined ? value.id : index}\r\n                                    avatar={avatarUser(value.user)}\r\n                                    title={mediaTitle(value)}\r\n                                    message={value.message}\r\n                                    id={value.id}\r\n                                    event={onMessageDelete}\r\n                                />\r\n                            )\r\n                        }) : <div></div>}\r\n                        <ChatInput\r\n                            avatar={avatarUser(user)}\r\n                            value={replyMessage}\r\n                            onChange={(e) => { setReplyMessage(e.target.value) }}\r\n                            onReply={onReplyClick}\r\n                            onUpdate={onUpdateClick}\r\n                            enableUpdate={true}\r\n                            setReplyImageUrl={setReplyImageUrl}\r\n                            enableImageUpload={true}\r\n                        />\r\n                    </div>\r\n                </GridItem>\r\n            </GridContainer>\r\n            <FloatyAssistant></FloatyAssistant>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default withRouter(AdminChatPage);"],"sourceRoot":""}